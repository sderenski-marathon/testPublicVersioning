name: Update Node Version

on:
  pull_request:
    types: [opened]

jobs:
  update-version:
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: read
      pull-requests: write
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
      - name: update version
        run: |
          echo ${{ github.event.action }}
          BRANCH_NAME="${{ github.head_ref }}"

          ANCESTOR=$(git merge-base origin/main HEAD)

          ANCESTOR_VERSION=$(git show $ANCESTOR:package.json | node -e "console.log(JSON.parse(require('fs').readFileSync(0, 'utf-8')).version)")

          node .github/scripts/initialVersion.js "$BRANCH_NAME" "$ANCESTOR_VERSION"
